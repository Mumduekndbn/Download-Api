<html>
  <link rel="stylesheet" href="watch/style.css">
  <head>
    <link rel="icon" href="watch/favicon.png">
    <title>Download API</title>
    <meta id="title" content="Download API Viewer" property="og:title">
    <meta id="description" content="View YouTube videos without the YouTube" property="og:description">
    <meta content="https://llsc12.ml/watch/favicon.png" property="og:image">
    <meta content="#00FFF4" data-react-helmet="true" name="theme-color">
  </head>
  <body>
    <h1 class="heading">Download API Viewer</h1>
    <input id="txt" class="URL-input" placeholder="Video URL">
    <video class="video" width="640" height="360" id="video" controls autoplay="false">
      <source id="source" src="" type="video/mp4">
    </video>

    <h1 class="search">Search</h1>
  </body>

  <script>
    function urlParse (url) {
      // thanks to Intelli :)
      let urlquery = url.split('?')[1]
      if (!urlquery) return []
      let params = urlquery.split('&')
      let array = new Array()
      for (each of params) {
        let split = each.split('=')
        array[split[0]]=split[1]
      }
      return array
    }
    let query = urlParse(document.URL)
    let urlStart = `api/v1/download?url=`
    var video = document.getElementById('video');
    var source = document.getElementById('source');
    let vidurl = document.getElementById('source').getAttribute('src')

    if (query["v"]) {
      //set player to query id
      source.setAttribute('src', urlStart+'https://youtu.be/'+query["v"]);
      vidurl = 'https://youtu.be/'+query["v"]
      document.getElementById('video').setAttribute('autoplay', "true");
      document.getElementById('txt').value = 'https://youtu.be/'+query["v"]
      video.load();
    }
    setInterval(() => {
      let txtbox = document.getElementById('txt').value
      if (vidurl !== txtbox) {
        let regexCode = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*?[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/gi
        if (!txtbox.match(regexCode)) return
        if (!(txtbox.match(regexCode).length == 1)) return
        if (!txtbox.match(regexCode)[0]) return
        document.getElementById('txt').value = "https://"+(txtbox.match(regexCode)[0])
        txtbox = document.getElementById('txt').value
        vidurl = txtbox
        source.setAttribute('src', urlStart+document.getElementById('txt').value);
        video.load();
        video.play();
      }
    }, 1000)
  </script>
</html>